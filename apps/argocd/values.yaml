argo-cd:
  server:
    service:
      type: LoadBalancer

  configs:
    cm:
    # append to argocd config for vault plugin
      configManagementPlugins: |-
        - name: argocd-vault-plugin
          generate:
            command: ["argocd-vault-plugin"]
            args: ["generate", "./"]
        # (add any other plugins as additional `- name: ...` sections)

  ## Repo Server
  repoServer:
    # -- Repo server name
    name: repo-server

    # -- The number of repo server pods to run
    replicas: 1

    volumeMounts:
    - mountPath: /usr/local/bin/argocd-vault-plugin
      subPath: argocd-vault-plugin
      name: custom-tools

    # -- Init containers to add to the repo server pods
    initContainers:
    - name: download-tools
      image: alpine:3.22.1
      command: [sh, -c]
      args:
      - |
        mkdir -p /custom-tools
        wget -O argocd-vault-plugin https://github.com/argoproj-labs/argocd-vault-plugin/releases/download/v1.18.1/argocd-vault-plugin_1.18.1_linux_amd64
        chmod +x argocd-vault-plugin
        mv argocd-vault-plugin /custom-tools/

      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
      envFrom:
        - secretRef:
            name: argocd-vault-plugin-credentials

    # -- Additional volumes to the repo server pod
    volumes:
      - name: custom-tools
        emptyDir: {}
